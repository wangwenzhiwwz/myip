<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>IP 地址查询工具</title>
<link rel="preconnect" href="https://api.ipify.org">
<link rel="preconnect" href="https://ipwho.is">
<link rel="preconnect" href="https://ipapi.co">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://dns.google">
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="apple-touch-icon" sizes="180x180" href="https://wangwenzhi.eu.org/images/favicon_io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wangwenzhi.eu.org/images/favicon_io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://wangwenzhi.eu.org/images/favicon_io/favicon-16x16.png">
<link rel="manifest" href="https://wangwenzhi.eu.org/images/favicon_io/site.webmanifest">
<style>
:root{
--bg:#fff;--text:#111;--secondary:#333;--tertiary:#888;--border:#eee;--light-border:#f0f0f0;--card:#fafafa;--shadow:0 1px 8px #eee;--radius:16px;--unit:8px;--skeleton-base:#ebebeb;--skeleton-shine:#f5f5f5
}
@media (prefers-color-scheme:dark){
:root{--bg:#1a1a1a;--text:#f0f0f0;--secondary:#ccc;--tertiary:#888;--border:#333;--light-border:#2a2a2a;--card:#2a2a2a;--shadow:0 1px 8px rgba(0,0,0,.3);--skeleton-base:#2c2c2c;--skeleton-shine:#383838}
.flag-img{filter:brightness(.9)saturate(1.2)}
}
html,body{margin:0;padding:0;height:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text)}
body{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:2vw;box-sizing:border-box}
.main{max-width:680px;width:100%;margin:12vh auto 0;display:flex;flex-direction:column;align-items:center;gap:calc(var(--unit)*2)}
.ip-card{display:flex;align-items:center;justify-content:center;gap:calc(var(--unit)*3);padding:calc(var(--unit)*2) 0;min-height:110px;width:100%}
.flag-skeleton{width:clamp(72px,15vw,90px);height:clamp(54px,11.25vw,67.5px);background:var(--skeleton-base);background:linear-gradient(90deg,var(--skeleton-base)25%,var(--skeleton-shine)50%,var(--skeleton-base)75%);background-size:200% 100%;animation:s 2s infinite ease-in-out;border-radius:10px;box-shadow:var(--shadow);flex-shrink:0}
@keyframes s{0%{background-position:200% 0}100%{background-position:-200% 0}}
.flag-img{width:clamp(72px,15vw,90px);aspect-ratio:4/3;border-radius:10px;box-shadow:var(--shadow);object-fit:cover;display:none;opacity:0;transition:opacity .4s}
.flag-img.loaded{display:block;opacity:1}
.info{display:flex;flex-direction:column;align-items:center;gap:10px}
#ipAddr{font-size:clamp(2rem,8vw,3.2rem);font-weight:700;cursor:pointer;transition:opacity .2s;text-align:center;word-break:break-all}
#ipAddr:hover{opacity:.8}
#ipPlace{font-size:clamp(1rem,4vw,1.3rem);color:var(--secondary);text-align:center;min-height:1.5em}
.skeleton{background:var(--skeleton-base);background:linear-gradient(90deg,var(--skeleton-base)25%,var(--skeleton-shine)50%,var(--skeleton-base)75%);background-size:200% 100%;animation:s 2s infinite ease-in-out;border-radius:8px}
.ip-big-value.skeleton{height:clamp(2rem,8vw,3.2rem);width:220px}
.ip-place.skeleton{height:1.5em;width:180px}
.detail-value.skeleton{height:1.2em;width:70%}
.card{background:var(--card);border-radius:var(--radius);padding:calc(var(--unit)*2) calc(var(--unit)*1.5);box-shadow:var(--shadow);width:100%;box-sizing:border-box}
.title{font-size:clamp(1.1rem,3.5vw,1.3rem);font-weight:700;color:var(--secondary);padding-bottom:calc(var(--unit)*.5);margin-bottom:calc(var(--unit)*.75);border-bottom:1px solid var(--border);letter-spacing:1px}
.row{display:grid;gap:calc(var(--unit)*.75)}
.cell{display:grid;grid-template-columns:1fr 2fr;gap:calc(var(--unit)*.5);align-items:center;padding:calc(var(--unit)*.5) 0;border-bottom:1px solid var(--light-border)}
.label{font-size:clamp(.9rem,3vw,1.05rem);color:var(--tertiary);font-weight:500;letter-spacing:.5px}
.value{font-size:clamp(.9rem,3vw,1.05rem);color:var(--text);word-break:break-all}
.coords-link{color:var(--text);text-decoration:none;cursor:pointer;transition:opacity .2s}
.coords-link:hover{opacity:.8}
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%);background:rgba(0,128,0,.9);color:#fff;padding:12px 24px;border-radius:30px;font-size:1rem;box-shadow:0 4px 12px rgba(0,0,0,.2);opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s,transform .3s;z-index:1000;display:flex;align-items:center;gap:8px}
.toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(-10px)}
@media (max-width:680px){.main{margin-top:10vh}.cell{grid-template-columns:1fr 1.5fr}}
@media (max-width:360px){.cell{grid-template-columns:1fr}.label{margin-bottom:2px}}
</style>
</head>
<body>
<div class="main">
  <div class="ip-card">
    <div id="flagSkeleton" class="flag-skeleton"></div>
    <img id="ip-flag" class="flag-img" alt="国旗"/>
    <div class="info">
      <div id="ipAddr" class="ip-big-value skeleton"></div>
      <div id="ipPlace" class="ip-place skeleton"></div>
    </div>
  </div>
  <div class="card">
    <div class="title">详细网络信息</div>
    <div class="row">
      <div class="cell"><div class="label">IPv6 地址</div><div id="ipv6" class="value"></div></div>
      <div class="cell"><div class="label">主机名</div><div id="hostname" class="value skeleton"></div></div>
      <div class="cell"><div class="label">国家</div><div id="country" class="value skeleton"></div></div>
      <div class="cell"><div class="label">自治系统（ASN）</div><div id="asn" class="value skeleton"></div></div>
      <div class="cell"><div class="label">运营商/组织</div><div id="org" class="value skeleton"></div></div>
      <div class="cell"><div class="label">大洲</div><div id="continent" class="value skeleton"></div></div>
      <div class="cell"><div class="label">坐标</div><div id="coords" class="value skeleton"></div></div>
      <div class="cell"><div class="label">邮编</div><div id="postal" class="value skeleton"></div></div>
    </div>
  </div>
</div>
<div id="toast" class="toast"><i class="fa fa-check"></i> 已复制 IP 地址！</div>

<script>
const els={ipAddr:document.getElementById('ipAddr'),ipPlace:document.getElementById('ipPlace'),ipv6:document.getElementById('ipv6'),hostname:document.getElementById('hostname'),country:document.getElementById('country'),asn:document.getElementById('asn'),org:document.getElementById('org'),continent:document.getElementById('continent'),coords:document.getElementById('coords'),postal:document.getElementById('postal'),flag:document.getElementById('ip-flag'),flagSk:document.getElementById('flagSkeleton'),toast:document.getElementById('toast')};
let lastIpv6='';

function toast(){els.toast.classList.add('show');setTimeout(()=>els.toast.classList.remove('show'),2000)}
els.ipAddr.onclick=async()=>{const ip=els.ipAddr.textContent.trim();if(ip&&ip!=='未知'){try{await navigator.clipboard.writeText(ip);toast()}catch{alert('复制失败')}}}

function rmSk(el){el.classList.remove('skeleton')}
function showFlag(){els.flagSk.style.display='none';els.flag.style.display='block';els.flag.classList.add('loaded')}

async function fetchT(url,t=6000){const c=new AbortController();setTimeout(()=>c.abort(),t);const r=await fetch(url,{signal:c.signal});if(!r.ok)throw'';const ct=r.headers.get('content-type')||'';return ct.includes('json')||ct.includes('text')?r.json():{text:(await r.text()).trim()}}
async function getIPs(){const [v4,v6]=await Promise.allSettled([fetchT('https://api.ipify.org?format=json'),fetchT('https://api64.ipify.org?format=json')]);const ipv4=v4.status==='fulfilled'?v4.value.ip||v4.value.text||'未知':'未知';const ipv6=v6.status==='fulfilled'?v6.value.ip||v6.value.text||'':'未检测到';if(ipv6&&ipv6!==ipv4)lastIpv6=ipv6;return{ipv4,ipv6:ipv6||lastIpv6||'未检测到'}}
async function getGeo(ip){const apis=[`https://ipwho.is/${ip?encodeURIComponent(ip):''}`,`https://ipapi.co/${ip?encodeURIComponent(ip)+'/':''}json/`,'https://ipinfo.io/json'];for(const u of apis){try{const d=await fetchT(u);if(d&&(d.ip||d.query||d.loc))return d}catch{}}return null}

function render(ip,geo){
  rmSk(els.ipAddr);
  if(!geo){rmSk(els.ipPlace);els.ipPlace.textContent='未知地区';els.flagSk.style.display='none';return}
  const place=(geo.country_name||geo.country||'')+(geo.city?' '+geo.city:'')+(geo.region_name||geo.region?' · '+(geo.region_name||geo.region):'');
  els.ipPlace.textContent=place||'未知地区';rmSk(els.ipPlace);
  let code=(geo.country_code||geo.country||'').toLowerCase();if(code.length===2){els.flag.src=`https://cdn.jsdelivr.net/npm/flag-icon-css@4.1.7/flags/4x3/${code}.svg`;els.flag.onload=showFlag;if(els.flag.complete&&els.flag.naturalWidth)showFlag()}else{els.flagSk.style.display='none'}
  [els.hostname,els.country,els.asn,els.org,els.continent,els.coords,els.postal].forEach(rmSk);
  els.ipv6.textContent=geo.ipv6||lastIpv6||'未检测到';
  els.country.textContent=geo.country_name||geo.country||'未知';
  const asnNum=geo.connection?.asn||geo.asn||'';
  els.asn.textContent=asnNum?'AS'+asnNum:'未知';
  els.org.textContent=geo.org||geo.connection?.isp||geo.isp||'未知';
  els.continent.textContent=geo.continent_name||geo.continent||'未知';
  const lat=geo.latitude||geo.lat,lon=geo.longitude||geo.lon;
  if(lat&&lon){
    els.coords.innerHTML=`<a href="https://www.google.com/maps?q=${lat},${lon}" target="_blank" class="coords-link">${lat}, ${lon}</a>`;
  }else{
    els.coords.textContent='未知';
  }
  els.postal.textContent=geo.postal||geo.postal_code||'未知';
  fetchHostname(geo.ip||geo.query||'').then(h=>els.hostname.textContent=h||'未检测到');
}

async function fetchHostname(ip){if(!ip)return'未检测到';try{const r=await fetch(`https://dns.google/resolve?name=${ip.split('.').reverse().join('.')}.in-addr.arpa&type=PTR`);const d=await r.json();return d.Answer?.[0]?.data?.replace(/\.$/,'')||'未检测到'}catch{return'未检测到'}}

async function start(){
  const {ipv4,ipv6}=await getIPs();
  const primary=ipv4!=='未知'?ipv4:(ipv6.includes('未检测到')?'未知':ipv6);
  els.ipAddr.textContent=primary;rmSk(els.ipAddr);els.ipv6.textContent=ipv6;
  if(primary==='未知'){els.flagSk.style.display='none';return}
  const geo=await getGeo(primary);
  render(primary,geo);
}
window.onload=()=>start();
</script>
</body>
</html>
