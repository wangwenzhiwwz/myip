<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>IP Address Lookup Tool</title>
<link rel="preconnect" href="https://api.ipify.org">
<link rel="preconnect" href="https://ipwho.is">
<link rel="preconnect" href="https://ipapi.co">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://dns.google">
<link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="apple-touch-icon" sizes="180x180" href="https://wangwenzhi.eu.org/images/favicon_io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://wangwenzhi.eu.org/images/favicon_io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://wangwenzhi.eu.org/images/favicon_io/favicon-16x16.png">
<link rel="manifest" href="https://wangwenzhi.eu.org/images/favicon_io/site.webmanifest">
<style>
:root{
--bg:#fff;--text:#111;--secondary:#333;--tertiary:#888;--border:#eee;--light-border:#f0f0f0;--card:#fafafa;--shadow:0 1px 8px #eee;--radius:16px;--unit:8px;--skeleton-base:#ebebeb;--skeleton-shine:#f5f5f5
}
@media (prefers-color-scheme:dark){
:root{--bg:#1a1a1a;--text:#f0f0f0;--secondary:#ccc;--tertiary:#888;--border:#333;--light-border:#2a2a2a;--card:#2a2a2a;--shadow:0 1px 8px rgba(0,0,0,.3);--skeleton-base:#2c2c2c;--skeleton-shine:#383838}
.flag-img{filter:brightness(.9)saturate(1.2)}
}
html,body{margin:0;padding:0;height:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background:var(--bg);color:var(--text)}
body{min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:env(safe-area-inset-top) 2vw env(safe-area-inset-bottom);box-sizing:border-box}
.main{max-width:680px;width:100%;margin:15vh auto 0;display:flex;flex-direction:column;align-items:center;gap:calc(var(--unit)*2)}
.ip-card{display:flex;align-items:center;justify-content:center;gap:calc(var(--unit)*3);padding:calc(var(--unit)*2) 0;min-height:110px;width:100%}
.flag-skeleton{width:clamp(72px,15vw,90px);height:clamp(54px,11.25vw,67.5px);background:var(--skeleton-base);background:linear-gradient(90deg,var(--skeleton-base)25%,var(--skeleton-shine)50%,var(--skeleton-base)75%);background-size:200% 100%;animation:s 2s infinite ease-in-out;border-radius:10px;box-shadow:var(--shadow);flex-shrink:0}
@keyframes s{0%{background-position:200% 0}100%{background-position:-200% 0}}
.flag-img{width:clamp(72px,15vw,90px);aspect-ratio:4/3;border-radius:10px;box-shadow:var(--shadow);object-fit:cover;display:none;opacity:0;transition:opacity .4s}
.flag-img.loaded{display:block;opacity:1}
.info{display:flex;flex-direction:column;align-items:center;gap:10px}
#ipAddr{font-size:clamp(2rem,8vw,3.2rem);font-weight:700;cursor:pointer;transition:opacity .2s;text-align:center;word-break:break-all;line-height:1.2}
#ipAddr:hover{opacity:.8}
#ipPlace{font-size:clamp(1rem,4vw,1.3rem);color:var(--secondary);text-align:center;min-height:1.5em}
.skeleton{background:var(--skeleton-base);background:linear-gradient(90deg,var(--skeleton-base)25%,var(--skeleton-shine)50%,var(--skeleton-base)75%);background-size:200% 100%;animation:s 2s infinite ease-in-out;border-radius:8px}
.ip-big-value.skeleton{height:clamp(2rem,8vw,3.2rem);width:220px}
.ip-place.skeleton{height:1.5em;width:180px}
.detail-value.skeleton{height:1.2em;width:70%}
.card{background:var(--card);border-radius:var(--radius);padding:calc(var(--unit)*2);box-shadow:var(--shadow);width:100%;box-sizing:border-box}
.title{font-size:clamp(1.1rem,3.5vw,1.3rem);font-weight:700;color:var(--secondary);padding-bottom:calc(var(--unit)*.5);margin-bottom:calc(var(--unit)*.75);border-bottom:1px solid var(--border);letter-spacing:1px}
.row{display:grid;gap:calc(var(--unit)*.75)}
.cell{display:grid;grid-template-columns:1fr 2fr;gap:calc(var(--unit)*.5);align-items:center;padding:calc(var(--unit)*.5) 0;border-bottom:1px solid var(--light-border)}
.label{font-size:clamp(.9rem,3vw,1.05rem);color:var(--tertiary);font-weight:500;letter-spacing:.5px}
.value{font-size:clamp(.9rem,3vw,1.05rem);color:var(--text);word-break:break-all}
.coords-link{color:var(--text);text-decoration:none;cursor:pointer;transition:opacity .2s}
.coords-link:hover{opacity:.8}

/* 语言切换（右上角，小按钮 + 简写） */
.lang-controls{position:fixed;top:env(safe-area-inset-top);right:8px;z-index:10;display:flex;background:var(--card);border-radius:16px;padding:4px;box-shadow:var(--shadow);gap:2px}
.lang-btn{padding:4px 10px;border:none;background:transparent;color:var(--text);font-size:.85rem;font-weight:600;cursor:pointer;border-radius:12px;transition:background .2s}
.lang-btn.active{background:var(--secondary);color:var(--bg)}

/* 刷新按钮（右下角，更小更简约） */
.refresh-fab{position:fixed;bottom:max(16px,env(safe-area-inset-bottom));right:12px;z-index:10;width:44px;height:44px;background:var(--card);color:var(--text);border:none;border-radius:50%;box-shadow:var(--shadow);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.2rem;transition:background .2s,transform .2s;opacity:0.8}
.refresh-fab:hover{opacity:1;transform:scale(1.1)}
.refresh-fab:active{transform:scale(.95)}

.toast{position:fixed;bottom:max(70px,calc(env(safe-area-inset-bottom)+16px));left:50%;transform:translateX(-50%);background:rgba(0,128,0,.9);color:#fff;padding:14px 28px;border-radius:30px;font-size:1rem;box-shadow:0 4px 12px rgba(0,0,0,.2);opacity:0;visibility:hidden;transition:opacity .3s,visibility .3s,transform .3s;z-index:1000;display:flex;align-items:center;gap:8px}
.toast.show{opacity:1;visibility:visible;transform:translateX(-50%) translateY(-10px)}
@media (max-width:680px){
.main{margin-top:12vh}
.cell{grid-template-columns:1fr 1.8fr}
.lang-controls{top:calc(env(safe-area-inset-top)+4px);right:4px;padding:3px}
.lang-btn{padding:3px 8px;font-size:.8rem}
.refresh-fab{width:40px;height:40px;font-size:1.1rem}
}
@media (max-width:480px){
.ip-card{flex-direction:column;gap:calc(var(--unit)*2)}
.info{gap:8px}
#ipAddr{font-size:clamp(1.8rem,7vw,2.8rem)}
}
@media (max-width:360px){
.cell{grid-template-columns:1fr}
.label{margin-bottom:4px}
}
</style>
</head>
<body>
<div class="main">
  <div class="ip-card">
    <div id="flagSkeleton" class="flag-skeleton"></div>
    <img id="ip-flag" class="flag-img" alt="Country Flag"/>
    <div class="info">
      <div id="ipAddr" class="ip-big-value skeleton"></div>
      <div id="ipPlace" class="ip-place skeleton"></div>
    </div>
  </div>
  <div class="card">
    <div class="title" data-zh="详细网络信息" data-en="Network Details"></div>
    <div class="row">
      <div class="cell"><div class="label" data-zh="IPv6 地址" data-en="IPv6 Address"></div><div id="ipv6" class="value"></div></div>
      <div class="cell"><div class="label" data-zh="主机名" data-en="Hostname"></div><div id="hostname" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="国家" data-en="Country"></div><div id="country" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="自治系统（ASN）" data-en="ASN"></div><div id="asn" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="运营商/组织" data-en="ISP / Organization"></div><div id="org" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="大洲" data-en="Continent"></div><div id="continent" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="坐标" data-en="Coordinates"></div><div id="coords" class="value skeleton"></div></div>
      <div class="cell"><div class="label" data-zh="邮编" data-en="Postal Code"></div><div id="postal" class="value skeleton"></div></div>
    </div>
  </div>
</div>

<!-- 语言切换（右上角，小按钮 + 简写） -->
<div class="lang-controls">
  <button class="lang-btn" data-lang="zh">中</button>
  <button class="lang-btn active" data-lang="en">EN</button>
</div>

<!-- 刷新按钮（右下角，更小更简约） -->
<button id="refreshBtn" class="refresh-fab" aria-label="Refresh">
  <i class="fa fa-refresh"></i>
</button>

<div id="toast" class="toast"><i class="fa fa-check"></i> <span data-zh="已复制 IP 地址！" data-en="IP Address Copied!"></span></div>

<script>
const els={ipAddr:document.getElementById('ipAddr'),ipPlace:document.getElementById('ipPlace'),ipv6:document.getElementById('ipv6'),hostname:document.getElementById('hostname'),country:document.getElementById('country'),asn:document.getElementById('asn'),org:document.getElementById('org'),continent:document.getElementById('continent'),coords:document.getElementById('coords'),postal:document.getElementById('postal'),flag:document.getElementById('ip-flag'),flagSk:document.getElementById('flagSkeleton'),toast:document.getElementById('toast'),toastMsg:document.querySelector('#toast span')};
let lastIpv6='';
let currentLang = 'en';

// 刷新按钮（右下角）
document.getElementById('refreshBtn').addEventListener('click', () => location.reload());

// 语言切换逻辑
const langBtns = document.querySelectorAll('.lang-btn');
function switchLang(lang){
  currentLang = lang;
  document.querySelectorAll('[data-zh]').forEach(el=>{
    el.textContent = el.getAttribute(`data-${lang}`);
  });
  document.documentElement.lang = lang;
  langBtns.forEach(btn=>btn.classList.toggle('active',btn.dataset.lang===lang));
  els.toastMsg.textContent = els.toastMsg.getAttribute(`data-${lang}`);
  if(els.coords.dataset.lat && els.coords.dataset.lon){
    renderCoords(els.coords.dataset.lat, els.coords.dataset.lon);
  }
}
switchLang('en');
langBtns.forEach(btn=>btn.addEventListener('click',()=>switchLang(btn.dataset.lang)));

function toast(){els.toast.classList.add('show');setTimeout(()=>els.toast.classList.remove('show'),2000)}
els.ipAddr.onclick=async()=>{const ip=els.ipAddr.textContent.trim();if(ip&&ip!=='Unknown'){try{await navigator.clipboard.writeText(ip);toast()}catch{alert('Copy failed')}}}

function rmSk(el){el.classList.remove('skeleton')}
function showFlag(){els.flagSk.style.display='none';els.flag.style.display='block';els.flag.classList.add('loaded')}

// localStorage 缓存 Geo 数据（10分钟有效期）
const CACHE_KEY = 'ip_geo_cache';
const CACHE_TTL = 10 * 60 * 1000;

async function fetchT(url,t=6000){const c=new AbortController();setTimeout(()=>c.abort(),t);const r=await fetch(url,{signal:c.signal});if(!r.ok)throw'';const ct=r.headers.get('content-type')||'';return ct.includes('json')||ct.includes('text')?r.json():{text:(await r.text()).trim()}}
async function getIPs(){const [v4,v6]=await Promise.allSettled([fetchT('https://api.ipify.org?format=json'),fetchT('https://api64.ipify.org?format=json')]);const ipv4=v4.status==='fulfilled'?v4.value.ip||v4.value.text||'Unknown':'Unknown';const ipv6=v6.status==='fulfilled'?v6.value.ip||v6.value.text||'':'Not Detected';if(ipv6&&ipv6!==ipv4)lastIpv6=ipv6;return{ipv4,ipv6:ipv6||lastIpv6||'Not Detected'}}
async function getGeo(ip){
  const cache = localStorage.getItem(CACHE_KEY);
  if(cache){
    const {data, timestamp, cachedIp} = JSON.parse(cache);
    if(cachedIp === ip && Date.now() - timestamp < CACHE_TTL){
      return data;
    }
  }
  const apis=[`https://ipwho.is/${ip?encodeURIComponent(ip):''}`,`https://ipapi.co/${ip?encodeURIComponent(ip)+'/':''}json/`,'https://ipinfo.io/json'];
  for(const u of apis){
    try{
      const d=await fetchT(u);
      if(d&&(d.ip||d.query||d.loc)){
        localStorage.setItem(CACHE_KEY, JSON.stringify({data:d, timestamp:Date.now(), cachedIp:ip}));
        return d;
      }
    }catch{}
  }
  return null;
}

function renderCoords(lat, lon){
  const mapUrl = currentLang === 'zh' 
    ? `https://uri.amap.com/marker?position=${lon},${lat}&name=您的位置` 
    : `https://www.google.com/maps?q=${lat},${lon}`;
  els.coords.innerHTML = `<a href="${mapUrl}" target="_blank" class="coords-link">${lat}, ${lon}</a>`;
  els.coords.dataset.lat = lat;
  els.coords.dataset.lon = lon;
}

function render(ip,geo){
  rmSk(els.ipAddr);
  if(!geo){rmSk(els.ipPlace);els.ipPlace.textContent=currentLang==='zh'?'未知地区':'Unknown Location';els.flagSk.style.display='none';return}
  const place=(geo.country_name||geo.country||'')+(geo.city?' '+geo.city:'')+(geo.region_name||geo.region?' · '+(geo.region_name||geo.region):'');
  els.ipPlace.textContent=place|| (currentLang==='zh'?'未知地区':'Unknown Location');rmSk(els.ipPlace);
  let code=(geo.country_code||geo.country||'').toLowerCase();if(code.length===2){els.flag.src=`https://cdn.jsdelivr.net/npm/flag-icon-css@4.1.7/flags/4x3/${code}.svg`;els.flag.onload=showFlag;if(els.flag.complete&&els.flag.naturalWidth)showFlag()}else{els.flagSk.style.display='none'}
  [els.hostname,els.country,els.asn,els.org,els.continent,els.coords,els.postal].forEach(rmSk);
  els.ipv6.textContent=geo.ipv6||lastIpv6|| (currentLang==='zh'?'未检测到':'Not Detected');
  els.country.textContent=geo.country_name||geo.country|| (currentLang==='zh'?'未知':'Unknown');
  const asnNum=geo.connection?.asn||geo.asn||'';
  els.asn.textContent=asnNum?(currentLang==='zh'?`AS${asnNum}`:`AS${asnNum}`): (currentLang==='zh'?'未知':'Unknown');
  els.org.textContent=geo.org||geo.connection?.isp||geo.isp|| (currentLang==='zh'?'未知':'Unknown');
  els.continent.textContent=geo.continent_name||geo.continent|| (currentLang==='zh'?'未知':'Unknown');
  const lat=geo.latitude||geo.lat,lon=geo.longitude||geo.lon;
  if(lat&&lon){
    renderCoords(lat, lon);
  }else{
    els.coords.textContent=currentLang==='zh'?'未知':'Unknown';
  }
  els.postal.textContent=geo.postal||geo.postal_code|| (currentLang==='zh'?'未知':'Unknown');
  fetchHostname(geo.ip||geo.query||'').then(h=>els.hostname.textContent=h|| (currentLang==='zh'?'未检测到':'Not Detected'));
}

async function fetchHostname(ip){if(!ip)return currentLang==='zh'?'未检测到':'Not Detected';try{const r=await fetch(`https://dns.google/resolve?name=${ip.split('.').reverse().join('.')}.in-addr.arpa&type=PTR`);const d=await r.json();return d.Answer?.[0]?.data?.replace(/\.$/,'')|| (currentLang==='zh'?'未检测到':'Not Detected')}catch{return currentLang==='zh'?'未检测到':'Not Detected'}}

async function start(){
  const {ipv4,ipv6}=await getIPs();
  const primary=ipv4!=='Unknown'?ipv4:(ipv6.includes('Not Detected')?'Unknown':ipv6);
  els.ipAddr.textContent=primary;rmSk(els.ipAddr);els.ipv6.textContent=ipv6;
  if(primary==='Unknown'){els.flagSk.style.display='none';return}
  const geo=await getGeo(primary);
  render(primary,geo);
}
window.onload=()=>start();
</script>
</body>
</html>